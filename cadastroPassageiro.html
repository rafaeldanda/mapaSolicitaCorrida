<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cadastro</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --primary: #0088cc; --bg: #f0f2f5; }
    body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .card { background: #fff; width: 90%; max-width: 380px; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; }
    input { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; outline: none; }
    input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(0,136,204,0.1); }
    .btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; }
    .btn:disabled { background: #ccc; }
  </style>
</head>
<body>

<div class="card">
  <h2 style="margin: 0 0 20px 0;">Cadastro</h2>
  
  <input id="nome" type="text" placeholder="Nome Completo">
  
  <input id="telefone" type="tel" inputmode="tel" placeholder="WhatsApp (00) 00000-0000" maxlength="15">
  
  <input id="email" type="email" placeholder="E-mail">
  
  <input id="cpf" type="text" inputmode="numeric" placeholder="CPF 000.000.000-00" maxlength="14">
  
  <input id="senha" type="password" placeholder="Senha">
  
  <button id="btnEnviar" class="btn" onclick="enviar()">CONCLUIR</button>
</div>

<script>
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  // Máscara de CPF (000.000.000-00)
  document.getElementById('cpf').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\={3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d)/, '$1.$2');
    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    e.target.value = value;
  });

  // Máscara de Telefone ((00) 00000-0000)
  document.getElementById('telefone').addEventListener('input', function (e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
    value = value.replace(/(\d{5})(\d)/, '$1-$2');
    e.target.value = value;
  });

  function enviar() {
    const btn = document.getElementById('btnEnviar');
    const webhookUrl = "https://primary-production-a103.up.railway.app/webhook/0421cb4e-c94e-40bc-ad39-823394a4d901";

    const dados = {
      fluxo: "CADASTRO_PASSAGEIRO",
      chatId: new URLSearchParams(window.location.search).get('chatId') || tg?.initDataUnsafe?.user?.id || "WEB",
      nome: document.getElementById('nome').value,
      telefone: document.getElementById('telefone').value,
      email: document.getElementById('email').value,
      cpf: document.getElementById('cpf').value,
      senha: document.getElementById('senha').value
    };

    if (!dados.nome || !dados.senha || dados.cpf.length < 14) {
      alert("Preencha os dados corretamente.");
      return;
    }

    btn.disabled = true;
    btn.innerText = "PRONTO! ✅";

    const query = new URLSearchParams(dados).toString();
    
    // Método ultra-rápido para não travar o Chrome
    const img = new Image();
    img.src = `${webhookUrl}?${query}&t=${Date.now()}`;

    setTimeout(() => {
      if (tg && tg.showAlert) {
        tg.showAlert("✅ Cadastro realizado!", () => tg.close());
      } else {
        alert("✅ Cadastro realizado!");
        // Redireciona para o bot no Chrome para fechar o ciclo
        window.location.href = "https://t.me/SEU_BOT_NOME"; 
      }
    }, 500);
  }
</script>
</body>
</html>